---
import { getCollection } from 'astro:content';
import PageLayout from '@layouts/PageLayout.astro';
import PhotoGrid from '@components/photo/PhotoGrid.astro';
import PhotoLightbox from '@components/photo/PhotoLightbox.astro';

const photos = (await getCollection('photos')).sort(
  (a, b) => a.data.sortOrder - b.data.sortOrder,
);

const lightboxPhotos = photos.map((p) => ({
  url: p.data.url,
  width: p.data.width,
  height: p.data.height,
  title: p.data.title,
  exif: p.data.exif,
}));
---

<PageLayout title="Gallery" description="All photos">
  <div class="gallery-header reveal">
    <h1>Gallery</h1>
    <span class="photo-count">{photos.length} photos</span>
  </div>
  <div class="gallery-grid-wrap">
    <PhotoGrid photos={photos} layout="masonry" sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, (max-width: 1440px) 33vw, (max-width: 1920px) 25vw, 20vw" />
  </div>
  <PhotoLightbox photos={lightboxPhotos} />
</PageLayout>

<style>
  .gallery-header {
    padding: var(--space-xl) var(--container-padding) var(--space-md);
  }

  .photo-count {
    font-size: var(--text-sm);
    color: var(--color-warm);
    margin-top: var(--space-sm);
    display: block;
  }

  .gallery-grid-wrap {
    padding-inline: var(--container-padding);
  }

  @media (min-width: 1920px) {
    .gallery-grid-wrap :global(.masonry-grid) {
      columns: 5;
    }
  }
</style>
