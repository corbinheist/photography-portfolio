---
import { getCollection } from 'astro:content';
import PageLayout from '@layouts/PageLayout.astro';
import HeroSection from '@components/home/HeroSection.astro';
import FeaturedWork from '@components/home/FeaturedWork.astro';
import AboutTeaser from '@components/home/AboutTeaser.astro';
import BlogSection from '@components/blog/BlogSection.astro';

const photos = await getCollection('photos');
const albums = await getCollection('albums');
const collections = await getCollection('photoCollections');

// Build a map from photo ID â†’ album page URL
function getPhotoLink(photoId: string): string | undefined {
  for (const album of albums) {
    if (album.data.draft || !album.data.photos.includes(photoId)) continue;
    const collection = collections.find((c) => c.data.albums.includes(album.id));
    if (collection) return `/work/${collection.id}/${album.id}`;
  }
}

const heroPhotos = photos.map((p) => ({
  url: p.data.url,
  width: p.data.width,
  height: p.data.height,
  lqip: p.data.lqip,
  link: getPhotoLink(p.id),
  featured: p.data.featured,
}));
---

<PageLayout title="Corbin Heist">
  <HeroSection photos={heroPhotos} />
  <FeaturedWork />
  <AboutTeaser />
  <BlogSection limit={4} responsive />
</PageLayout>
