---
/**
 * PhotoLightbox â€” client-side fullscreen image viewer.
 * Triggered by clicking on gallery items.
 */

interface PhotoInfo {
  url: string;
  width: number;
  height: number;
  title: string;
  exif?: {
    camera?: string;
    lens?: string;
    focalLength?: string;
    aperture?: string;
    shutter?: string;
    iso?: number;
  };
}

interface Props {
  photos: PhotoInfo[];
}

const { photos } = Astro.props;
---

<div class="lightbox" data-lightbox aria-hidden="true" aria-modal="true" role="dialog" aria-label="Photo viewer">
  <button class="lightbox-close" data-lightbox-close aria-label="Close viewer">&times;</button>

  <div class="lightbox-stage">
    <button class="lightbox-nav lightbox-prev" data-lightbox-prev aria-label="Previous photo">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="15 18 9 12 15 6"></polyline></svg>
    </button>

    <div class="lightbox-image-wrap">
      <img class="lightbox-img" data-lightbox-img src="" alt="" />
    </div>

    <button class="lightbox-nav lightbox-next" data-lightbox-next aria-label="Next photo">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="9 18 15 12 9 6"></polyline></svg>
    </button>
  </div>

  <div class="lightbox-info" data-lightbox-info></div>
</div>

<!-- Pass photo data via a hidden JSON script (avoids HTML-encoding issues with <template>) -->
<script type="application/json" data-lightbox-data set:html={JSON.stringify(photos)}></script>

<script>
  import { initLightbox } from '@scripts/lightbox';

  document.addEventListener('astro:page-load', initLightbox);
</script>

<style>
  .lightbox {
    position: fixed;
    inset: 0;
    z-index: var(--z-lightbox);
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    flex-direction: column;
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--duration-normal) ease;
  }

  .lightbox[aria-hidden='false'] {
    opacity: 1;
    pointer-events: auto;
  }

  .lightbox-close {
    position: absolute;
    top: var(--space-md);
    right: var(--space-md);
    background: none;
    border: none;
    color: white;
    font-size: var(--text-2xl);
    cursor: pointer;
    opacity: 0.6;
    transition: opacity var(--duration-fast) ease;
    z-index: 1;
    line-height: 1;
  }

  .lightbox-close:hover {
    opacity: 1;
  }

  .lightbox-stage {
    flex: 1;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 0;
    overflow: hidden;
    padding: var(--space-md);
  }

  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    opacity: 0.4;
    transition: opacity var(--duration-fast) ease;
    padding: var(--space-md);
    z-index: 1;
  }

  .lightbox-nav:hover {
    opacity: 1;
  }

  .lightbox-prev {
    left: var(--space-sm);
  }

  .lightbox-next {
    right: var(--space-sm);
  }

  .lightbox-image-wrap {
    max-width: 90vw;
    max-height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .lightbox-img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: opacity 150ms ease, transform var(--duration-normal) var(--ease-out-expo);
  }

  .lightbox-img:global(.is-entering) {
    opacity: 0;
    transform: scale(0.95);
  }

  .lightbox-img:global(.is-transitioning) {
    opacity: 0;
  }

  @media (prefers-reduced-motion: reduce) {
    .lightbox-img {
      transition: none;
    }
  }

  .lightbox-info {
    flex-shrink: 0;
    padding: var(--space-sm) var(--space-xl);
    text-align: center;
    color: white;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
    min-height: 3.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .lightbox-info :global(.lightbox-title) {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    font-style: italic;
    font-weight: 400;
    margin-bottom: var(--space-xs);
    max-width: none;
  }

  .lightbox-info :global(.lightbox-exif) {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    letter-spacing: 0.02em;
    opacity: 0.5;
    margin-bottom: var(--space-xs);
    max-width: none;
  }

  .lightbox-info :global(.lightbox-exif-sep) {
    opacity: 0.3;
    margin-inline: 0.5em;
  }

  .lightbox-info :global(.lightbox-counter) {
    font-size: var(--text-xs);
    opacity: 0.3;
    max-width: none;
  }
</style>
