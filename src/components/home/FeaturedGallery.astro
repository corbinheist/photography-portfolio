---
import { getCollection } from 'astro:content';
import PhotoGrid from '@components/photo/PhotoGrid.astro';
import PhotoLightbox from '@components/photo/PhotoLightbox.astro';
import Button from '@components/ui/Button.astro';

const allPhotos = (await getCollection('photos')).sort(
  (a, b) => a.data.sortOrder - b.data.sortOrder,
);

const featured = allPhotos.filter((p) => p.data.featured);
const photos = (featured.length > 0 ? featured : allPhotos).slice(0, 50);

const lightboxPhotos = photos.map((p) => ({
  url: p.data.url,
  width: p.data.width,
  height: p.data.height,
  title: p.data.title,
  exif: p.data.exif,
}));
---

<section class="featured-gallery">
  <PhotoGrid photos={photos} layout="masonry" sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, (max-width: 1440px) 33vw, (max-width: 1920px) 25vw, 20vw" />
  <div class="featured-cta reveal">
    <Button href="/gallery">View Full Gallery</Button>
  </div>
  <PhotoLightbox photos={lightboxPhotos} />
</section>

<style>
  .featured-gallery {
    padding-bottom: var(--space-3xl);
  }

  .featured-gallery :global(.masonry-grid) {
    padding: 0;
    column-gap: 0;
  }

  .featured-gallery :global(.masonry-item) {
    margin-bottom: 0;
  }

  @media (min-width: 1920px) {
    .featured-gallery :global(.masonry-grid) {
      columns: 5;
    }
  }

  .featured-cta {
    margin-top: var(--space-xl);
    text-align: center;
    padding-inline: var(--container-padding);
  }
</style>
