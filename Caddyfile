# Caddyfile for photography portfolio
# Place at /etc/caddy/Caddyfile on the droplet

example.com {
	root * /var/www/portfolio/dist
	file_server

	# Compression
	encode zstd gzip

	# Cache static assets aggressively (fonts, images, CSS, JS)
	@static {
		path *.css *.js *.woff2 *.avif *.webp *.jpg *.png *.svg *.ico
	}
	header @static Cache-Control "public, max-age=31536000, immutable"

	# Cache HTML for 1 hour
	@html {
		path *.html /
	}
	header @html Cache-Control "public, max-age=3600, must-revalidate"

	# Security headers
	header {
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Referrer-Policy strict-origin-when-cross-origin
	}

	# SPA-style fallback for 404
	handle_errors {
		@404 expression {err.status_code} == 404
		handle @404 {
			rewrite * /404.html
			file_server
		}
	}
}
